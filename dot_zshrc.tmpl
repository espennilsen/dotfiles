# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# Common PATH
export PATH=$HOME/bin:$HOME/.local/bin:/usr/local/bin:$PATH

{{- if eq .chezmoi.os "darwin" }}

# --- macOS: lightweight shell setup (no oh-my-zsh) ---

# Homebrew
if [[ -f /opt/homebrew/bin/brew ]]; then
  eval "$(/opt/homebrew/bin/brew shellenv)"
fi

# Powerlevel10k (installed via brew)
if [[ -f $(brew --prefix)/share/powerlevel10k/powerlevel10k.zsh-theme ]]; then
  source $(brew --prefix)/share/powerlevel10k/powerlevel10k.zsh-theme
fi

# Completions
autoload -Uz compinit
compinit

# History
HISTSIZE=50000
SAVEHIST=50000
HISTFILE=~/.zsh_history
setopt SHARE_HISTORY
setopt HIST_IGNORE_DUPS
setopt HIST_IGNORE_SPACE
setopt HIST_REDUCE_BLANKS

# Key bindings
bindkey -e

# Useful aliases (git)
alias g="git"
alias gs="git status"
alias ga="git add"
alias gc="git commit"
alias gp="git push"
alias gl="git log --oneline --graph --decorate"
alias gd="git diff"
alias gco="git checkout"

# Locale
export LANG=nb_NO.UTF-8
export LC_ALL=nb_NO.UTF-8

# tea completion
if command -v tea &> /dev/null; then
  source <(tea completion zsh)
fi

# gh completion
if command -v gh &> /dev/null; then
  eval "$(gh completion -s zsh)"
fi

# zoxide (smarter cd)
if command -v zoxide &> /dev/null; then
  eval "$(zoxide init zsh)"
fi

# fzf key bindings and completion
if command -v fzf &> /dev/null; then
  source <(fzf --zsh)
fi

# console-ninja
[[ -d ~/.console-ninja/.bin ]] && PATH=~/.console-ninja/.bin:$PATH

# LM Studio CLI
[[ -d "$HOME/.cache/lm-studio/bin" ]] && export PATH="$PATH:$HOME/.cache/lm-studio/bin"

# Antigravity
[[ -d "$HOME/.antigravity/antigravity/bin" ]] && export PATH="$HOME/.antigravity/antigravity/bin:$PATH"

# Go
[[ -d "$HOME/go/bin" ]] && export PATH="$HOME/go/bin:$PATH"

# Android SDK
if [[ -d "$HOME/Library/Android/sdk" ]]; then
  export ANDROID_SDK_ROOT="$HOME/Library/Android/sdk"
  export ANDROID_HOME="$ANDROID_SDK_ROOT"
  export PATH="$PATH:$ANDROID_SDK_ROOT/emulator"
  export PATH="$PATH:$ANDROID_SDK_ROOT/platform-tools"
  export PATH="$PATH:$ANDROID_SDK_ROOT/cmdline-tools/latest/bin"
fi

neofetch

{{- else }}

# --- Linux: oh-my-zsh setup ---

export ZSH="$HOME/.oh-my-zsh"
ZSH_THEME="powerlevel10k/powerlevel10k"
DISABLE_AUTO_UPDATE="true"

# zsh-navigation widgets
zle -N znt-cd-widget
bindkey "^B" znt-cd-widget
zle -N znt-kill-widget
bindkey "^Y" znt-kill-widget

plugins=(git git-lfs mosh supervisor tmux tmuxinator ufw zsh-navigation-tools)

source $ZSH/oh-my-zsh.sh

{{- end }}

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

# Activate mise (version manager for node, pnpm, bun, etc.)
if command -v mise &> /dev/null; then
  eval "$(mise activate zsh)"
fi
